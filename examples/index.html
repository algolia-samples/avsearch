<html>
  <head>
    <title>
      AV/Search
    </title>
  </head>
  <body>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@algolia/autocomplete-theme-classic"
    />
    <link rel="stylesheet" href="style.css" />

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@algolia/autocomplete-theme-classic"
    />
    <style>
      :root {
        --aa-icon-size: 80px;
      }
    </style>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <div id="autocomplete"></div>
    <script src="https://cdn.jsdelivr.net/npm/@algolia/autocomplete-js"></script>
    <script src="https://cdn.jsdelivr.net/npm/preact/dist/preact.min.js"></script>
    <script
        src="https://cdn.jsdelivr.net/npm/algoliasearch@4.5.1/dist/algoliasearch-lite.umd.js"
        integrity="sha256-EXPXz4W6pQgfYY3yTpnDa3OH8/EPn16ciVsPQ/ypsjk="
        crossorigin="anonymous"
    ></script>
    <script>
      const { autocomplete, getAlgoliaResults } = window['@algolia/autocomplete-js'];
      const appId = "OKF83BFQS4";
      const apiKey = "2ee1381ed11d3fe70b60605b1e2cd3f4";
      const searchClient = algoliasearch(appId, apiKey);
      const indexName = "chuck-video-index";

      const { setIsOpen } = autocomplete({
          container: "#autocomplete",
          placeholder: "Search",
          detachedMediaQuery: '',
          openOnFocus: true,
          getSources({ query, state }) {
            if (!query) {
              return [];
            }

            return [
              {
                sourceId: "videos",
                getItems() {
                  return getAlgoliaResults({
                    searchClient,
                    queries: [
                      {
                        indexName: indexName,
                        query,
                        params: {
                          attributesToSnippet: ['videoTitle:10', 'text:20'],
                          snippetEllipsisText: 'â€¦',
                          hitsPerPage: 10
                        }
                      }
                    ]
                  });
                },
                templates: {
                  header() {
                    return (
                      "Posts"
                    );
                  },
                  item({ item, components, html }) {
                    return html`<div class="aa-ItemWrapper">
                      <div class="aa-ItemContent">
                        <div class="aa-ItemIcon aa-ItemIcon--alignTop">
                          <a href="${item.url}"><img
                            src="${item.thumbnail}"
                            alt="${item.title}"
                            width="80"
                            height="80"
                          /></a>
                        </div>
                        <div class="aa-ItemContentBody">
                          <div class="aa-ItemContentTitle">
                            <a href="${item.url}">
                              ${components.Snippet({
                                hit: item,
                                attribute: 'videoTitle',
                              })}
                            </a>
                          </div>
                          <div class="aa-ItemContentSubtitle">
                              <strong>${item.categories}</strong>
                          </div>
                          <div class="aa-ItemContentDescription">
                            ${components.Snippet({
                              hit: item,
                              attribute: 'text',
                            })}
                          </div>
                        </div>
                      </div>
                    </div>`;
                  },
                  noResults() {
                    return "No videos for this query.";
                  }
                },
                getItemUrl({ item }) {
                  return item.url;
                },
              }
            ];
          }
        });        
        document.addEventListener('keydown', (event) => {
        if (event.metaKey && event.key.toLowerCase() === 'k') {
          setIsOpen(true);
        }
      });
    </script>
  </body>
</html>